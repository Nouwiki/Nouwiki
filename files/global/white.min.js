var White={selector:"img",brightness:33,contrast:50,black_threshold:40,white_threshold:255,images:[],origin:window.location.origin,proxy:"http://crossorigin.me/",loadLeft:0,run:function(t){if(this.selector=t,0==this.loadLeft){this.initImages();for(var i in this.images)this.applyToImage(this.images[i],!1)}},restore:function(t){var i=document.querySelectorAll(t);for(var e in i)this.restoreImage(i[e])},initImages:function(){this.images=[];var t=document.querySelectorAll(this.selector);for(var i in t)if(void 0!=t[i].style&&"IMG"==t[i].tagName){this.images.push([t[i],t[i].dataset.src||t[i].src,[[t[i].width],[t[i].height]],t[i].style.visibility]);var e=this.images[this.images.length-1];e[0].style.visibility="hidden"}this.loadLeft=this.images.length},applyToImage:function(t,i){var e=this,s=new Image;s.onload=function(){var i=t[0].width,h=t[0].height,r=e.getCanvas(i,h),a=e.filterImage(s,i,h,r),o=r.getContext("2d");o.putImageData(a,0,0);var n=r.toDataURL();void 0==t[0].dataset.src&&(t[0].dataset.src=t[0].src),t[0].src=n,t[0].style.visibility=t[3],e.loadLeft-=1},s.onerror=function(s,h,r){1==i?(t[0].src=t[1],e.loadLeft-=1):e.applyToImage(t,!0)};var h;h=i?this.proxy+t[1]:t[1],0!=h.indexOf(this.origin)&&(s.crossOrigin="Anonymous"),s.src=h},restoreImage:function(t){void 0!=t.dataset.src&&"IMG"==t.tagName&&(t.src=t.dataset.src)},getCanvas:function(t,i){var e=document.createElement("canvas");return e.width=t,e.height=i,e},filterImage:function(t,i,e,s){return this.filter(this.getPixels(t,i,e,s))},getPixels:function(t,i,e,s){var h=s.getContext("2d");return h.fillStyle="#FFF",h.fillRect(0,0,s.width,s.height),h.globalCompositeOperation="luminosity",h.drawImage(t,0,0,s.width,s.height),h.getImageData(0,0,s.width,s.height)},filter:function(t){for(var i=t.data,e=0;e<i.length;e+=4)i[e]+=this.brightness,i[e+1]+=this.brightness,i[e+2]+=this.brightness;for(var s=259*(this.contrast+255)/(255*(259-this.contrast)),e=0;e<i.length;e+=4)i[e]=s*(i[e]-128)+128,i[e+1]=s*(i[e+1]-128)+128,i[e+2]=s*(i[e+2]-128)+128;for(var e=0;e<i.length;e+=4){var h=i[e],r=i[e+1],a=i[e+2];h<this.black_threshold&&(i[e]=this.black_threshold),r<this.black_threshold&&(i[e+1]=this.black_threshold),a<this.black_threshold&&(i[e+2]=this.black_threshold)}for(var e=0;e<i.length;e+=4){var h=i[e],r=i[e+1],a=i[e+2];h>this.white_threshold&&(i[e]=this.white_threshold),r>this.white_threshold&&(i[e+1]=this.white_threshold),a>this.white_threshold&&(i[e+2]=this.white_threshold)}return t}};
